#!/usr/bin/env ruby

require "rubygems"
require "commander/import"
require "canary"
require "canary/version"

program :version, Canary::VERSION
program :description, "CLI application that will allow us to test an EDR agent and ensure it generates the appropriate telemetry."

command :simulate_telemetry do |c|
  c.syntax = "canary simulate_telemetry"
  c.summary = "Simulates activity detection and logs simulated events."
  c.option "--cmd STRING", String, "A command to start a process (ex: ruby -v)"
  c.action do |args, options|
    options.default \
      cmd: "ruby -v"
    puts "EDR Simulation: Starting..."
    Canary::Simulator.new(command: options.cmd).simulate_all
    puts "EDR Simulation: Complete!"
  end
end
